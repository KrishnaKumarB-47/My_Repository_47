{% extends "base.html" %}

{% block title %}Browse Products - AI Artisan Marketplace{% endblock %}

{% block content %}
<div class="browse-container">
    <div class="browse-header">
        <h1>Browse Products</h1>
        <p>Discover unique handmade products from talented artisans</p>
    </div>
    
    <!-- Filters and Search -->
    <div class="filters-section">
        <form method="GET" class="filters-form">
            <div class="filter-group">
                <label for="search">Search Products</label>
                <input type="text" id="search" name="search" value="{{ current_search }}" 
                       placeholder="Search by name or description...">
            </div>
            
            <div class="filter-group">
                <label for="category">Category</label>
                <select id="category" name="category">
                    <option value="all" {% if current_category == 'all' %}selected{% endif %}>All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat }}" {% if current_category == cat %}selected{% endif %}>
                        {{ cat.title() }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sort">Sort By</label>
                <select id="sort" name="sort">
                    <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Newest First</option>
                    <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>Oldest First</option>
                    <option value="price_low" {% if current_sort == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                    <option value="price_high" {% if current_sort == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                    <option value="name" {% if current_sort == 'name' %}selected{% endif %}>Name A-Z</option>
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Apply Filters
            </button>
        </form>
    </div>
    
    <!-- Products Grid -->
    <div class="products-section">
        {% if products %}
            <div class="products-grid">
                {% for product in products %}
                <div class="product-card" onclick="viewProduct({{ product[1] }})">
                    <div class="product-image">
                        {% if product[5] %}
                            <img src="{{ url_for('uploaded_file', filename=product[5]) }}" alt="{{ product[2] }}">
                        {% else %}
                            <i class="fas fa-image"></i>
                        {% endif %}
                    </div>
                    <div class="product-info">
                        <h3>{{ product[2] }}</h3>
                        <p class="product-description">{{ product[3] }}</p>
                        <p class="product-category">{{ product[0] }}</p>
                        <p class="product-price">â‚¹{{ "%.2f"|format(product[4]) }}</p>
                        <p class="product-artisan">by {{ product[7] }}</p>
                        {% if product[6] %}
                        <div class="ai-story-preview">
                            <h4>AI Story:</h4>
                            <p>{{ product[6][:150] }}{% if product[6]|length > 150 %}...{% endif %}</p>
                        </div>
                        {% endif %}
                        <div class="product-actions">
                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); addToCart({{ product[1] }})">
                                <i class="fas fa-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h3>No products found</h3>
                <p>Try adjusting your search criteria or browse all products</p>
                <a href="{{ url_for('browse') }}" class="btn btn-primary">View All Products</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function viewProduct(productId) {
    window.location.href = `/view_product/${productId}`;
}

async function addToCart(productId) {
    try {
        const response = await fetch('/add_to_cart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_id: productId,
                quantity: 1
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification('Product added to cart!', 'success');
        } else {
            showNotification('Error: ' + result.message, 'error');
        }
    } catch (error) {
        showNotification('An error occurred. Please try again.', 'error');
    }
}
</script>
{% endblock %}
